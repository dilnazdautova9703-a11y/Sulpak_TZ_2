<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Sulpak ‚Äî –¢–ó –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Inter','Segoe UI',-apple-system,sans-serif;background:#0a0f1a;color:#fff;height:100dvh;overflow:hidden}
  #app{max-width:520px;margin:0 auto;height:100dvh;display:flex;flex-direction:column;background:#0E1621;position:relative}

  .header{background:#17212B;padding:14px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid #1E2C3A;flex-shrink:0}
  .header-avatar{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,#E8452C,#FF6F20);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;flex-shrink:0;box-shadow:0 2px 12px rgba(232,69,44,0.3)}
  .header-info{flex:1}
  .header-title{font-weight:600;font-size:15px}
  .header-status{font-size:12px;color:#6B8A9E;margin-top:2px}

  .chat{flex:1;overflow-y:auto;padding:14px 14px 8px;display:flex;flex-direction:column;gap:10px;scroll-behavior:smooth}
  .chat::-webkit-scrollbar{width:4px}
  .chat::-webkit-scrollbar-thumb{background:#2A3F52;border-radius:4px}

  .msg{display:flex;animation:fadeIn 0.3s ease}
  .msg.user{justify-content:flex-end}
  .msg.bot{justify-content:flex-start}

  .bubble{max-width:85%;padding:10px 15px;font-size:14px;line-height:1.55;word-break:break-word}
  .bubble.bot{background:#182533;color:#E1E8ED;border-radius:16px 16px 16px 4px}
  .bubble.user{background:linear-gradient(135deg,#3B82C4,#2B6DA8);color:#fff;border-radius:16px 16px 4px 16px}
  .bubble p{margin:0 0 8px 0}.bubble p:last-child{margin:0}
  .bubble strong{color:#7EB8E0}
  .bubble em{color:#FFB74D;font-style:normal}

  .bubble-file{max-width:82%;border-radius:16px 16px 4px 16px;overflow:hidden;background:#1a3250}
  .bubble-file img{display:block;max-width:260px;max-height:200px;object-fit:cover;border-radius:12px 12px 0 0;cursor:pointer}
  .bubble-file-info{padding:8px 12px;display:flex;align-items:center;gap:8px}
  .bubble-file-icon{font-size:22px;flex-shrink:0}
  .bubble-file-meta{flex:1;min-width:0}
  .bubble-file-name{font-size:13px;color:#E1E8ED;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .bubble-file-size{font-size:11px;color:#6B8A9E;margin-top:1px}

  .typing-dots{display:flex;gap:4px;padding:8px 0;align-items:center}
  .typing-dots span{width:7px;height:7px;border-radius:50%;background:#6B8A7A;animation:bounce 1.2s ease-in-out infinite}
  .typing-dots span:nth-child(2){animation-delay:0.2s}
  .typing-dots span:nth-child(3){animation-delay:0.4s}

  .tz-result{animation:fadeIn 0.5s ease;background:#182533;border-radius:12px;padding:18px;margin-top:4px;border:1px solid #2A3F52}
  .tz-header{display:flex;align-items:center;gap:8px;margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid #2A3F52}
  .tz-header-dot{width:8px;height:8px;border-radius:50%;background:#4ADE80}
  .tz-header-text{font-size:12px;color:#6B8A9E;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
  .tz-content{font-size:12.5px;line-height:1.65;color:#C8D6E0;white-space:pre-wrap;word-break:break-word;font-family:'Cascadia Code','Fira Code','Courier New',monospace}

  .btn-copy{margin-top:14px;width:100%;padding:13px;border-radius:10px;border:none;background:linear-gradient(135deg,#E8452C,#FF6F20);color:#fff;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.3s;font-family:inherit}
  .btn-copy:hover{opacity:0.9;transform:translateY(-1px)}
  .btn-copy.copied{background:linear-gradient(135deg,#2EAD4B,#3CC760)}

  .input-area{flex-shrink:0;background:#17212B;border-top:1px solid #1E2C3A;padding:10px 14px}
  .pending-files{display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap}
  .pending-file{display:flex;align-items:center;gap:6px;background:#1a2d42;border:1px solid #2A3F52;border-radius:10px;padding:4px 10px 4px 6px;font-size:12px;color:#7EB8E0;max-width:200px}
  .pending-file img{width:28px;height:28px;border-radius:4px;object-fit:cover}
  .pending-file-icon{font-size:18px}
  .pending-file-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}
  .pending-file-remove{cursor:pointer;color:#FF6B6B;font-size:14px;font-weight:700;margin-left:2px;padding:0 2px}

  .input-row{display:flex;gap:8px;align-items:center}
  .input-field{flex:1;padding:11px 16px;border-radius:22px;border:1px solid #2A3F52;background:#0E1621;color:#E1E8ED;font-size:14px;outline:none;font-family:inherit;transition:border-color 0.2s}
  .input-field:focus{border-color:#3B82C4}
  .input-field::placeholder{color:#4A6478}
  .btn-attach{width:44px;height:44px;border-radius:50%;border:none;background:transparent;color:#6B8A9E;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.2s}
  .btn-attach:hover{color:#7EB8E0;background:rgba(59,130,196,0.1)}
  .btn-send{width:44px;height:44px;border-radius:50%;border:none;background:#2A3F52;color:#fff;font-size:18px;cursor:default;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.2s}
  .btn-send.active{background:linear-gradient(135deg,#E8452C,#FF6F20);cursor:pointer}

  .lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:999;display:flex;align-items:center;justify-content:center;cursor:zoom-out;animation:fadeIn 0.2s}
  .lightbox img{max-width:95%;max-height:90%;object-fit:contain;border-radius:8px}

  .error-msg{background:rgba(255,100,100,0.1);border:1px solid rgba(255,100,100,0.2);border-radius:12px;padding:12px;font-size:13px;color:#FF8A8A;line-height:1.4}

  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  @keyframes bounce{0%,60%,100%{transform:translateY(0);opacity:.4}30%{transform:translateY(-6px);opacity:1}}
  @media(min-width:521px){body{background:#080c15}#app{box-shadow:0 0 60px rgba(0,0,0,0.5);border-left:1px solid #1a2535;border-right:1px solid #1a2535}}
</style>
</head>
<body>
<div id="app">
  <div class="header">
    <div class="header-avatar">S</div>
    <div class="header-info">
      <div class="header-title">Sulpak ‚Äî –¢–ó –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</div>
      <div class="header-status" id="status">AI –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫</div>
    </div>
  </div>
  <div class="chat" id="chat"></div>
  <div class="input-area" id="inputArea">
    <div class="input-row">
      <button class="btn-attach" id="btnAttach" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª / —Å–∫—Ä–∏–Ω—à–æ—Ç">üìé</button>
      <input class="input-field" id="textInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." autofocus>
      <button class="btn-send" id="btnSend">‚û§</button>
    </div>
  </div>
  <input type="file" id="fileInput" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.csv,.txt,.json,.xml" style="display:none">
</div>

<script>
// ===== CONFIG =====
// –í—Å–µ–≥–¥–∞ /api/messages ‚Äî Vercel serverless function
const API_URL = '/api/messages';

// ===== SYSTEM PROMPT =====
const SYSTEM_PROMPT = `–¢—ã ‚Äî —Å—Ç–∞—Ä—à–∏–π –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏ Sulpak (–∫—Ä—É–ø–Ω–µ–π—à–∞—è –∫–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–∞—è —Å–µ—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ –∏ –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏). –ö —Ç–µ–±–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π (–ª–æ–≥–∏—Å—Ç–∏–∫–∞, –∫–æ–º–º–µ—Ä—Ü–∏—è, –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è, —Ä–æ–∑–Ω–∏—Ü–∞, –æ–ø—Ç–æ–≤—ã–π –æ—Ç–¥–µ–ª, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω) —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–∞ IT-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.

–¢–í–û–Ø –ó–ê–î–ê–ß–ê: —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥ —Å–æ–±—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–µ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ –¥–ª—è IT-–æ—Ç–¥–µ–ª–∞.

‚ïê‚ïê‚ïê –ü–†–ê–í–ò–õ–ê –í–ï–î–ï–ù–ò–Ø –î–ò–ê–õ–û–ì–ê ‚ïê‚ïê‚ïê

1. –ó–ê–î–ê–í–ê–ô –í–û–ü–†–û–°–´ –ü–û –û–î–ù–û–ú–£. –ù–µ –∑–∞—Å—ã–ø–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–ø–∏—Å–∫–æ–º –≤–æ–ø—Ä–æ—Å–æ–≤. –û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å ‚Äî –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç. –ò–Ω–æ–≥–¥–∞ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å 2 —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ.

2. –ù–ê–ß–ò–ù–ê–ô –° –û–ë–©–ï–ì–û, –£–ì–õ–£–ë–õ–Ø–ô–°–Ø –í –î–ï–¢–ê–õ–ò:
   - –°–Ω–∞—á–∞–ª–∞: –∫—Ç–æ —Ç—ã, –∏–∑ –∫–∞–∫–æ–≥–æ –æ—Ç–¥–µ–ª–∞, —á—Ç–æ –∑–∞ –∑–∞–¥–∞—á–∞
   - –ü–æ—Ç–æ–º: –∫–∞–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, —á—Ç–æ —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å
   - –ó–∞—Ç–µ–º: –∫—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω—É–∂–Ω—ã
   - –î–∞–ª—å—à–µ: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, —Å—Ü–µ–Ω–∞—Ä–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   - –í –∫–æ–Ω—Ü–µ: —Å—Ä–æ–∫–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –∫—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ

3. –ê–ù–ê–õ–ò–ó–ò–†–£–ô –û–¢–í–ï–¢–´ –ò –£–¢–û–ß–ù–Ø–ô:
   - –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –∏–ª–∏ –Ω–µ—á—ë—Ç–∫–∏–π ‚Äî –ø–µ—Ä–µ—Å–ø—Ä–æ—Å–∏. –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª "–Ω—É–∂–Ω–∞ –≤—ã–≥—Ä—É–∑–∫–∞" ‚Üí —Å–ø—Ä–æ—Å–∏ "–í—ã–≥—Ä—É–∑–∫–∞ —á–µ–≥–æ –∏–º–µ–Ω–Ω–æ? –ö—É–¥–∞? –í –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ? –ö—Ç–æ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø?"
   - –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ ‚Äî –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º–∏–Ω–∞–µ—Ç —á—Ç–æ-—Ç–æ –≤–∞–∂–Ω–æ–µ –≤—Å–∫–æ–ª—å–∑—å ‚Äî —Ä–∞–∑–≤–µ—Ä–Ω–∏ —Ç–µ–º—É

4. –ü–û–î–¢–í–ï–†–ñ–î–ê–ô –ü–û–ù–ò–ú–ê–ù–ò–ï: –ü–æ—Å–ª–µ –≤–∞–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∫—Ä–∞—Ç–∫–æ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —á—Ç–æ —Ç—ã –ø–æ–Ω—è–ª. –ü—Ä–∏–º–µ—Ä: "–ü–æ–Ω—è–ª ‚Äî —Å–µ–π—á–∞—Å –º–µ–Ω–µ–¥–∂–µ—Ä—ã –≤—Ä—É—á–Ω—É—é –≤–Ω–æ—Å—è—Ç –¥–∞–Ω–Ω—ã–µ –æ –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö –≤ Excel, –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å 1–°. –í–µ—Ä–Ω–æ?"

5. –ù–ï –ó–ê–î–ê–í–ê–ô –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –í–û–ü–†–û–°–´ (–∫–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–∞–∫–∞—è –ë–î). –¢—ã —Å–æ–±–∏—Ä–∞–µ—à—å –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.

6. –ï–°–õ–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–†–ò–õ–û–ñ–ò–õ –§–ê–ô–õ/–°–ö–†–ò–ù–®–û–¢ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —á—Ç–æ —Ç—ã –Ω–∞ –Ω—ë–º –≤–∏–¥–∏—à—å –∏ –∫–∞–∫ —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –¢–ó. –ó–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Ñ–∞–π–ª–∞.

7. –ù–ï –§–ê–ù–¢–ê–ó–ò–†–£–ô. –ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ –∑–Ω–∞–µ—à—å ‚Äî —Å–ø—Ä–æ—Å–∏. –ù–µ –¥–æ–¥—É–º—ã–≤–∞–π –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

8. –ë–£–î–¨ –î–†–£–ñ–ï–õ–Æ–ë–ù–´–ú –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º. –¢—ã —ç–∫—Å–ø–µ—Ä—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏—à–ª–∏ –∑–∞ –ø–æ–º–æ—â—å—é.

‚ïê‚ïê‚ïê –ö–û–ì–î–ê –î–ê–ù–ù–´–• –î–û–°–¢–ê–¢–û–ß–ù–û ‚ïê‚ïê‚ïê

–ö–æ–≥–¥–∞ —Ç—ã —Å–æ–±—Ä–∞–ª –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ –ø–æ—Å–ª–µ 8-15 –æ–±–º–µ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏), —Å–∫–∞–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ –≥–æ—Ç–æ–≤ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¢–ó –∏ —Å–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç ‚Äî —Å—Ñ–æ—Ä–º–∏—Ä—É–π –¢–ó.

‚ïê‚ïê‚ïê –§–û–†–ú–ê–¢ –ò–¢–û–ì–û–í–û–ì–û –¢–ó ‚ïê‚ïê‚ïê

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å, –≤—ã–≤–µ–¥–∏ –¢–ó —Å—Ç—Ä–æ–≥–æ –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

[–¢–ó_–ù–ê–ß–ê–õ–û]
(–∑–¥–µ—Å—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¢–ó)
[–¢–ó_–ö–û–ù–ï–¶]

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¢–ó:

1. –û–ë–©–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ, –∑–∞–∫–∞–∑—á–∏–∫, –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ, –¥–∞—Ç–∞, –õ–ü–†
2. –û–ü–ò–°–ê–ù–ò–ï –¢–ï–ö–£–©–ï–ô –°–ò–¢–£–ê–¶–ò–ò ‚Äî —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –æ–ø–∏—à–∏ –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≥–æ —á—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
3. –¶–ï–õ–ò –ò –ó–ê–î–ê–ß–ò –ü–†–û–ï–ö–¢–ê ‚Äî –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Ü–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º —è–∑—ã–∫–æ–º, –¥–æ–±–∞–≤—å –∏–∑–º–µ—Ä–∏–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
4. –¶–ï–õ–ï–í–ê–Ø –ê–£–î–ò–¢–û–†–ò–Ø ‚Äî –∫—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∏—Ö —Ä–æ–ª–∏, —É—Ä–æ–≤–µ–Ω—å, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
5. –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø ‚Äî –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫, –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ
6. –°–¶–ï–ù–ê–†–ò–ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø ‚Äî –ø–æ—à–∞–≥–æ–≤–æ: –∫—Ç–æ ‚Üí —á—Ç–æ –¥–µ–ª–∞–µ—Ç ‚Üí —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç
7. –ò–ù–¢–ï–ì–†–ê–¶–ò–ò ‚Äî —Å –∫–∞–∫–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è, –≤ –∫–∞–∫–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
8. –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –û–¢–ß–Å–¢–ù–û–°–¢–ò ‚Äî –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ
9. –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ò –¢–†–ï–ë–û–í–ê–ù–ò–Ø ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã
10. –†–ò–°–ö–ò –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ê–ù–ê–õ–ò–¢–ò–ö–ê ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–æ–µ–≥–æ –æ–ø—ã—Ç–∞ –æ–ø–∏—à–∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏ –¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –≠—Ç–æ –≤–∞–∂–Ω–µ–π—à–∏–π —Ä–∞–∑–¥–µ–ª! –ü—Ä–∏–º–µ—Ä—ã:
    - "–†–∏—Å–∫: –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 1–° –≤–æ–∑–º–æ–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–∑-–∑–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –≤–µ—Ä—Å–∏–∏. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –≤–µ—Ä—Å–∏–∏ 1–° –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
    - "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —ç—Ç–∞–ø –ø–∏–ª–æ—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –æ–¥–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–µ –ø–µ—Ä–µ–¥ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º"
11. –°–†–û–ö–ò –ò –ü–†–ò–û–†–ò–¢–ï–¢
12. –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ‚Äî —É–ø–æ–º—è–Ω–∏ –≤—Å–µ —Ñ–∞–π–ª—ã/—Å–∫—Ä–∏–Ω—à–æ—Ç—ã —á—Ç–æ –ø—Ä–∏–ª–æ–∂–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
13. –û–¢–ö–†–´–¢–´–ï –í–û–ü–†–û–°–´ ‚Äî —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É—Ç–æ—á–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

–í–ê–ñ–ù–û –¥–ª—è –¢–ó:
- –†–ê–ó–í–û–†–ê–ß–ò–í–ê–ô –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã. "–ù—É–∂–Ω–∞ –≤—ã–≥—Ä—É–∑–∫–∞" ‚Üí –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, —Ñ–æ—Ä–º–∞—Ç, —Ñ–∏–ª—å—Ç—Ä—ã, –∫—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø
- –ü–ï–†–ï–§–û–†–ú–£–õ–ò–†–£–ô –±—ã—Ç–æ–≤–æ–π —è–∑—ã–∫ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π. "–ß—Ç–æ–± –Ω–µ —Ç–æ—Ä–º–æ–∑–∏–ª–æ" ‚Üí "–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 3 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ N –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
- –î–û–ë–ê–í–õ–Ø–ô –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ Sulpak
- –ö–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–º, –Ω–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º

‚ïê‚ïê‚ïê –ö–û–ù–¢–ï–ö–°–¢ –ö–û–ú–ü–ê–ù–ò–ò ‚ïê‚ïê‚ïê
Sulpak ‚Äî –∫—Ä—É–ø–Ω–µ–π—à–∏–π —Ä–∏—Ç–µ–π–ª–µ—Ä —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ. –°–∏—Å—Ç–µ–º—ã: 1–° (ERP), —Å–∞–π—Ç sulpak.kz, CRM, —Å–∫–ª–∞–¥—Å–∫–æ–π —É—á—ë—Ç, –ª–æ–≥–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç–∞–ª. –ú–∞–≥–∞–∑–∏–Ω—ã –ø–æ –≤—Å–µ–º—É –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—É.`;

// ===== STATE =====
const conversationHistory = [];
const uploadedFiles = [];
let pendingFiles = [];
let isProcessing = false;

const chat = document.getElementById('chat');
const inputArea = document.getElementById('inputArea');
const statusEl = document.getElementById('status');
const textInput = document.getElementById('textInput');
const btnSend = document.getElementById('btnSend');
const btnAttach = document.getElementById('btnAttach');
const fileInput = document.getElementById('fileInput');

function scrollDown(){setTimeout(()=>chat.scrollTop=chat.scrollHeight,60)}
function formatSize(b){if(b<1024)return b+' –ë';if(b<1048576)return(b/1024).toFixed(1)+' –ö–ë';return(b/1048576).toFixed(1)+' –ú–ë'}
function isImageType(t){return t.startsWith('image/')}
function isPdfType(t){return t==='application/pdf'}
function getFileIcon(t){if(isImageType(t))return'üñºÔ∏è';if(isPdfType(t))return'üìÑ';if(t.includes('spreadsheet')||t.includes('excel')||t.includes('csv'))return'üìä';if(t.includes('word')||t.includes('document'))return'üìù';return'üìÅ'}

function addBotMessage(html){
  const w=document.createElement('div');w.className='msg bot';
  const b=document.createElement('div');b.className='bubble bot';b.innerHTML=html;
  w.appendChild(b);chat.appendChild(w);scrollDown();
}
function addUserMessage(text){
  const w=document.createElement('div');w.className='msg user';
  const b=document.createElement('div');b.className='bubble user';b.textContent=text;
  w.appendChild(b);chat.appendChild(w);scrollDown();
}
function addFileMessage(file){
  const w=document.createElement('div');w.className='msg user';
  const b=document.createElement('div');b.className='bubble-file';
  if(file.isImage){const img=document.createElement('img');img.src='data:'+file.type+';base64,'+file.base64;img.onclick=()=>{const lb=document.createElement('div');lb.className='lightbox';lb.innerHTML=`<img src="${img.src}">`;lb.onclick=()=>lb.remove();document.body.appendChild(lb)};b.appendChild(img)}
  const info=document.createElement('div');info.className='bubble-file-info';
  info.innerHTML=`<span class="bubble-file-icon">${getFileIcon(file.type)}</span><div class="bubble-file-meta"><div class="bubble-file-name">${file.name}</div><div class="bubble-file-size">${formatSize(file.size)}</div></div>`;
  b.appendChild(info);w.appendChild(b);chat.appendChild(w);scrollDown();
}
function addErrorMessage(text){
  const w=document.createElement('div');w.className='msg bot';
  const d=document.createElement('div');d.className='error-msg';d.textContent=text;
  w.appendChild(d);chat.appendChild(w);scrollDown();
}
function showTyping(){
  isProcessing=true;statusEl.textContent='–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç...';
  const w=document.createElement('div');w.className='msg bot';w.id='typing-indicator';
  w.innerHTML='<div class="bubble bot"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
  chat.appendChild(w);scrollDown();
}
function hideTyping(){
  isProcessing=false;statusEl.textContent='AI –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫';
  const el=document.getElementById('typing-indicator');if(el)el.remove();
}
function renderTZ(tzText){
  const r=document.createElement('div');r.className='tz-result';
  r.innerHTML=`<div class="tz-header"><div class="tz-header-dot"></div><span class="tz-header-text">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ</span></div><div class="tz-content" id="tzContent"></div><button class="btn-copy" id="btnCopy">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¢–ó</button>`;
  chat.appendChild(r);
  document.getElementById('tzContent').textContent=tzText;
  document.getElementById('btnCopy').onclick=()=>{
    navigator.clipboard.writeText(tzText);
    const btn=document.getElementById('btnCopy');btn.textContent='‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';btn.className='btn-copy copied';
    setTimeout(()=>{btn.textContent='üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¢–ó';btn.className='btn-copy'},2000);
  };
  scrollDown();
}
function formatBotText(text){
  return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.+?)\*/g,'<em>$1</em>')
    .replace(/\n/g,'<br>');
}

// ===== FILES =====
btnAttach.onclick=()=>fileInput.click();
fileInput.onchange=(e)=>{
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader();
    reader.onload=()=>{pendingFiles.push({name:file.name,size:file.size,type:file.type||'application/octet-stream',base64:reader.result.split(',')[1],isImage:isImageType(file.type)});renderPendingFiles()};
    reader.readAsDataURL(file);
  });
  fileInput.value='';
};
function renderPendingFiles(){
  let strip=document.getElementById('pendingStrip');
  if(!strip){strip=document.createElement('div');strip.className='pending-files';strip.id='pendingStrip';inputArea.insertBefore(strip,inputArea.querySelector('.input-row'))}
  strip.innerHTML='';
  pendingFiles.forEach((f,i)=>{
    const el=document.createElement('div');el.className='pending-file';
    el.innerHTML=(f.isImage?`<img src="data:${f.type};base64,${f.base64}">`:`<span class="pending-file-icon">${getFileIcon(f.type)}</span>`)+`<span class="pending-file-name">${f.name}</span><span class="pending-file-remove" data-i="${i}">√ó</span>`;
    strip.appendChild(el);
  });
  strip.querySelectorAll('.pending-file-remove').forEach(b=>b.onclick=(e)=>{pendingFiles.splice(+e.target.dataset.i,1);renderPendingFiles()});
  if(!pendingFiles.length&&strip)strip.remove();
  updateSendBtn();
}
function updateSendBtn(){btnSend.className=(textInput.value.trim()||pendingFiles.length)?'btn-send active':'btn-send'}
textInput.oninput=updateSendBtn;

function compressImage(base64,type){
  return new Promise(resolve=>{
    const img=new Image();
    img.onload=()=>{
      const MAX=1024;let w=img.width,h=img.height;
      if(w>MAX||h>MAX){if(w>h){h=Math.round(h*MAX/w);w=MAX}else{w=Math.round(w*MAX/h);h=MAX}}
      const c=document.createElement('canvas');c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);
      resolve(c.toDataURL('image/jpeg',0.75).split(',')[1]);
    };
    img.onerror=()=>resolve(base64);
    img.src='data:'+type+';base64,'+base64;
  });
}

// ===== SEND =====
async function sendMessage(){
  const text=textInput.value.trim();
  if((!text&&!pendingFiles.length)||isProcessing)return;
  if(text)addUserMessage(text);
  textInput.value='';updateSendBtn();

  const files=[...pendingFiles];pendingFiles=[];
  const strip=document.getElementById('pendingStrip');if(strip)strip.remove();
  files.forEach(f=>{addFileMessage(f);uploadedFiles.push(f)});

  const userContent=[];
  for(const f of files.filter(f=>f.isImage)){
    const compressed=await compressImage(f.base64,f.type);
    userContent.push({type:"image",source:{type:"base64",media_type:"image/jpeg",data:compressed}});
    userContent.push({type:"text",text:`[–ü—Ä–∏–ª–æ–∂–µ–Ω —Å–∫—Ä–∏–Ω—à–æ—Ç: ${f.name}]`});
  }
  for(const f of files.filter(f=>isPdfType(f.type)&&f.size<4*1024*1024)){
    userContent.push({type:"document",source:{type:"base64",media_type:"application/pdf",data:f.base64}});
    userContent.push({type:"text",text:`[–ü—Ä–∏–ª–æ–∂–µ–Ω PDF: ${f.name}]`});
  }
  for(const f of files.filter(f=>!f.isImage&&!isPdfType(f.type))){
    try{const decoded=atob(f.base64).substring(0,5000);userContent.push({type:"text",text:`[–§–∞–π–ª "${f.name}" (${f.type}):\n${decoded}]`})}
    catch{userContent.push({type:"text",text:`[–§–∞–π–ª: ${f.name} (${formatSize(f.size)})]`})}
  }
  if(text)userContent.push({type:"text",text});
  if(!userContent.length)return;

  conversationHistory.push({role:"user",content:userContent.length===1&&userContent[0].type==="text"?userContent[0].text:userContent});

  showTyping();
  try{
    const res=await fetch(API_URL,{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:4000,system:SYSTEM_PROMPT,messages:conversationHistory}),
    });
    const data=await res.json();
    hideTyping();
    if(data.error){addErrorMessage('–û—à–∏–±–∫–∞: '+(data.error.message||JSON.stringify(data.error)));conversationHistory.pop();return}
    const assistantText=data.content?.map(c=>c.type==="text"?c.text:"").filter(Boolean).join("\n")||"";
    if(!assistantText){addErrorMessage('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');conversationHistory.pop();return}
    conversationHistory.push({role:"assistant",content:assistantText});

    const tzMatch=assistantText.match(/\[–¢–ó_–ù–ê–ß–ê–õ–û\]([\s\S]*?)\[–¢–ó_–ö–û–ù–ï–¶\]/);
    if(tzMatch){
      const before=assistantText.split('[–¢–ó_–ù–ê–ß–ê–õ–û]')[0].trim();
      if(before)addBotMessage(formatBotText(before));
      renderTZ(tzMatch[1].trim());
      const after=assistantText.split('[–¢–ó_–ö–û–ù–ï–¶]')[1]?.trim();
      if(after)addBotMessage(formatBotText(after));
    }else{addBotMessage(formatBotText(assistantText))}
  }catch(err){hideTyping();addErrorMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: '+err.message);conversationHistory.pop()}
}

btnSend.onclick=sendMessage;
textInput.onkeydown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}};

// ===== INIT =====
setTimeout(async()=>{
  showTyping();
  try{
    const res=await fetch(API_URL,{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:300,system:SYSTEM_PROMPT,
        messages:[{role:"user",content:"[–°–∏—Å—Ç–µ–º–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã–ª —á–∞—Ç. –ü–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –µ–≥–æ –∏ –∑–∞–¥–∞–π –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å.]"}]}),
    });
    const data=await res.json();hideTyping();
    const text=data.content?.map(c=>c.type==="text"?c.text:"").filter(Boolean).join("")||"";
    if(text&&!data.error){
      conversationHistory.push({role:"user",content:"[–°–∏—Å—Ç–µ–º–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã–ª —á–∞—Ç. –ü–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –µ–≥–æ –∏ –∑–∞–¥–∞–π –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å.]"});
      conversationHistory.push({role:"assistant",content:text});
      addBotMessage(formatBotText(text));
    }else{addBotMessage(fallbackGreeting())}
  }catch{hideTyping();addBotMessage(fallbackGreeting())}
  textInput.focus();
},500);

function fallbackGreeting(){
  return '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø ‚Äî AI –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫ Sulpak. –ü–æ–º–æ–≥—É —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ –¥–ª—è IT-–æ—Ç–¥–µ–ª–∞.<br><br>–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ ‚Äî <strong>–∫–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç</strong>, –∏–∑ –∫–∞–∫–æ–≥–æ –≤—ã <strong>–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</strong>, –∏ <strong>–∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É</strong>, —Å –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏—à–ª–∏?<br><br>üìé –ú–æ–∂–µ—Ç–µ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–ª–∏ —Ñ–∞–π–ª—ã ‚Äî —è –∏—Ö –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é.';
}
</script>
</body>
</html>
